= Görüntüde Gölge Yumuşatma

== 1) İçindekiler
. İçindekiler
. Versiyon Geçmişi
. Giriş
. Sayısal Görüntü ve Görüntü İşlemeNedir?
.. Görüntü İşleme Nedir?
.. Görüntü İşleme ile Gölge Tespiti
. Bayesian Sınıflandırma ile Gölge Tespiti
.. Bayesian Sınıflandırma
.. Python ile Bayesian Sınıflandırmanın Görüntüye Uygulanması
.. Sonuçlar
. Otsu Eşikleme Metodu ile Gölge Tespiti
.. Otsu Eşikleme Metodu
.. Python ile Otsu Eşikleme Metodunun Görüntüye Uygulanması
.. Sonuçlar
. Histogram Aralığı ile Gölge Tespiti
.. Histogram Nedir?
.. Histogram Aralığı Nasıl Tespit Edilir?
.. Python ile Histogram Aralığının Görüntüye Uygulanması
.. Sonuçlar
. Referanslar

== 2) Versiyon Geçmişi

|===
|Tarih|Değişiklik|Kişi

|10.01.2017
|Görüntüde Gölge Tespiti

|Gönül TOKTAY
|10.01.2017
 
|Görüntüde Gölge Tespiti
|M.Sıla Genç

|02.02.2017

|Düzenleme
|Merve Tafralı

|===

== 3) Giriş

== 4)Sayısal Görüntü ve Görüntü İşleme Nedir?

===4.1) Görüntü İşleme Nedir?

Gerçek yaşamda, bir görüntü veya resim basit 2 değişkenin bir fonksiyonu olarak tanımlanır. ω a(x,y) gibi bir fonksiyonla ifade edilen bir resimde a bir şiddet birimi( örneğin parlaklık) ve x ve y değişkenleri ise resmin gerçek koordinatlarıdır.[1] +
Dijital görüntü sayısal değerlerden oluşur. ω 1 ve 0’lardan oluşan sayısal görüntü yapımız a[m,n], 2 boyutlu dünyadan elde edilen a(x,y) fonksiyonundan örnekleme tekniği kullanılarak oluşturulur.

image::1.png[1]

Sayısal bir görüntü M ve N sayılarında satır ve sütünlardan oluşur ve satır ve sütünların kesiştiği her bölgeye pixel denir. ω O piksel’deki değer ise derinlik (z) , renk(λ) ve zamanın(t) bir fonksiyonudur. +
Dijital bir resim haline getirilmiş olan gerçek yaşamdaki görüntülerin, bir girdi resim olarak işlenerek, o resmin özelliklerinin ve görüntüsünün değiştirilmesi sonucunda yeni bir resmin oluşturulmasıdır.[1] +
Görüntüler genellikle analog ortamlardan dijital ortamlara geçirildiği için bozukluk içerir. Bozukluklar gürültü olarak da ifade edilirler. Gürültüler görüntü üzerinde istenmeyen sinyallerdir. Görüntü işleme bu hataları  düzeltmek için kullanılabilir.Görüntü işleme bnun dışında farklı alanlarda da kullanılabilmektedir. +

image::2.png[2]

=== 4.2)Görüntü İşleme ile Gölge Tespiti
Görüntülerdeki gölgeler,görüntü kalitesinin azalmasına sebep olmaktadır. Bu sebepten ötürü gölgelerin belirlenerek yumuşatılması gerekebilmektedir. Gölgenin belirlenmesi için Bayesian sınıflandırma algoritmasından yararlanılacaktır. Sınıflandırma algoritması görüntü işleme kapsamında Python programlama kullanılarak örneklenmeye çalışılacaktır.

== 5)Bayesian Sınıflandırması
Sınıflandırmanın genel amacı bir nitelik değerini,diğerlerini kullanarak belirlemektir. Veri dağılımına göre bir model elde edilir. Elde edilen bu model başarımı belirlendikten sonra niteliğin bilinmeyen değerini tahmin etmek için kullanılır. +
Bayes sınıflandırmasında; +
* Niteliklerin hepsi aynı derecede önem sahibi
* Nitelikler birbirlerinden bağımsızdır; yani bir nitelik değeri diğer bir nitelik değeri hakkında bilgi içermemektedir.+
Çalışmada kullanılacak sınıflandırma renkler üzerinden gerçekleştirilecektir. Piksel değerinin gölge olarak nitelendirilmesi için o pikselin ve  genel görüntü üzerinde yapılacak olasılık işlemlerinin sonuçlarına göre karar verilecektir. +

=== 5.1)  Python ile Bayesian Sınıflandırmanın Görüntüye Uygulanması

[source,python]
---------------------------------------------------------------------

from PIL import Image           #PIL modülünden IMAGE kütüphanesini uygulamamıza dahil ediyoruz.

image=Image.open("image.jpg")       #image değişkeninin içerisine proje klasörümüzde bulunan 'image' adlı resim dosyasını atıyoruz.
newmat = image.load()           #newmat adlı yeni bir matris oluşturup bunun içerisine resim dosyamızı yüklüyoruz.
wdh=image.size[0]           #wgh değişkenine resim dosyasının genişlik boyutunu atıyoruz. Dosyamızın genişliği 640 piksel.
hgh=image.size[1]           #hgh değişkenine resim dosyasının yükseklik boyutunu atıyoruz. Dosyamızın yüksekliği 360 piksel.
shapelist=[[0]*hgh for x in range(wdh)]     #Bayes sınıflandırmada kullanılacak listeler bulunacaktır. Bunlardan biri de gölge piksellerinin tutulacağı shapelist olacaktır.
r_list=[[0]*hgh for x in range(wdh)]        #Görüntüde bulunan her renk için bir liste tutulacaktır. Daha sonra bu renkler karşılaştırılacaktır. Olasılıkları hepsalanıp bayes sınıflandırması yapılacaktır.
g_list=[[0]*hgh for x in range(wdh)]        #Yeşil renk sınıfını tutan liste.
b_list=[[0]*hgh for x in range(wdh)]        #Mavi renk sınıfını tutan liste.
for i in range(wdh):        #İç içe döngü ile görüntünün piksel renk kodları çekilir.
    for j in range(hgh):
        r, g, b = image.getpixel((i, j))        #Resimde bulunan her piksele ait r,g,b renk kodları getpiksel fonksiyonu ile alınır.
        r_list[i][j]=r          #Alınan her derğer kendi listesine kaydedilir.
        g_list[i][j]=g
        b_list[i][j]=b
hist_r=[0]*256      #Olasılık hesaplamasında kullanılacak olan histogramalr hazırlanır. Olasılık için bize gerekli olan frekans hesabını histogram ile gerçekleştirdiğimizden her renk kodu için ayrı bir histogram tutulacaktır.
hist_g=[0]*256      #g_list için tutulan histogram.
hist_b=[0]*256      #b_list için tutulan histogram.
for m in range(wdh):        #Listeler içerisinde girip her listenin histogramını belirlememiz gereklidir. Bunun için iç içe döngüler kullanıyoruz.
    for n in range(hgh):
        a=r_list[m][n]          #Her tuttuğumuz listenin piksel değerini alıp bunu sırasıyla değişkenlerde tutuyoruz.
        b=g_list[m][n]  
        c=b_list[m][n]
        hist_r[a]=hist_r[a]+1   #Histogram değerleri için bulduğumuz değişkenleri bir arttırarak topluyoruz.
        hist_g[b]=hist_g[b]+1
        hist_b[c]=hist_b[c]+1
sum_r, sum_g, sum_b = 0, 0, 0       #Tüm histogram değerlerinin toplandığı sum değişkenleri tanımlandı.
for p in range (len(hist_r)-1):     #Kırmızı renk histogramının tüm değerleri indisi ile çarpılıp toplanır.
    sum_r=(hist_r[p]*p)+sum_r   
for p in range (len(hist_g)-1):     #Yeşil renk histogramının tüm değerleri indisi ile çarpılıp toplanır.
    sum_g=(hist_g[p]*p)+sum_g
for p in range (len(hist_b)-1):     #Mavi renk histogramının tüm değerleri indisi ile çarpılıp toplanır.
    sum_b=(hist_b[p]*p)+sum_b
mean_r=sum_r/(wdh*hgh)      #Olasılıkların hesaplanması için tüm toplama boyut bölünür ve ortalama değer hesaplanır.
mean_g=sum_g/(wdh*hgh)
mean_b=sum_b/(wdh*hgh)
poseb2=(float(hist_r[mean_r])/(hist_r[mean_r]       #Formülden ilk olasılık değeri hesaplanır.
             +hist_g[mean_g]
             +hist_b[mean_b]))*(float(hist_g[mean_g])/(hist_r[mean_r]
             +hist_g[mean_g]+hist_b[mean_b]))*(float(hist_b[mean_b])/(hist_r[mean_r]
             +hist_g[mean_g]+hist_b[mean_b]))
for x in range(wdh):            #İkinci olasılık hesabı ve bu hesaba göre görüntünün değerinin hesaplanması için iç içe döngü oluşturuldu.
    for y in range(hgh):
        poseb1=(hist_r[r_list[x][y]]/(hist_r[r_list[x][y]]      #Formülden ikinci olasılık değeri hesaplanır.
               +hist_b[b_list[x][y]]
               +hist_g[g_list[x][y]]+0.01))*(hist_g[g_list[x][y]]/(hist_r[r_list[x][y]]
               +hist_b[b_list[x][y]]
               +hist_g[g_list[x][y]]+0.01))*(hist_b[b_list[x][y]]/(hist_r[r_list[x][y]]
               +hist_b[b_list[x][y]]
               +hist_g[g_list[x][y]]+0.01))
        if(poseb1>poseb2):          #Listeler arası ortalama değer eğer daha büyükse histogram değerlerine göre görüntünün o bölgesine beyaz renk verilir.
            shapelist[x][y]=1
            newmat[x,y]=(255,255,255)
        else:           #Değilse siyah renk atılır.
            shapelist[x][y]=0
            newmat[x,y]=(0,0,0)
image.save("bayes.bmp")     #Görüntünün son hali proje klasörüne kaydedilir.
---------------------------------------------------------------------
